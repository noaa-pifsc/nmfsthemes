---
title: "Designing UNHCR Branded Charts using unhcrthemes"
---

```{r, include = FALSE}
library(ragg)
knitr::opts_chunk$set(
  message = FALSE,
  warning = FALSE,
  collapse = TRUE,
  comment = "#>",
  dev = "ragg_png",
  fig.retina = 2,
  dpi = 300
)
```

Data visualization is a powerful tool for conveying information and insights from complex datasets. The [United Nations High Commissioner for Refugees](https://www.unhcr.org/) (UNHCR) provides crucial [refugee statistics](https://www.unhcr.org/refugee-statistics/download/) that can be presented in an informative and visually appealing manner. The `{unhcrthemes}` package, in combination with the `{refugees}` package and the versatile `{ggplot2}` library, offers an excellent solution to create UNHCR-branded charts with ease.

## Setup

Before we start creating UNHCR branded charts, make sure you have the **necessary packages installed**:

```{r install, eval=FALSE}
# Install CRAN packages
packages <- c("refugees", "tidyverse", "scales", "ragg", "pak")
install.packages(setdiff(packages, rownames(installed.packages())))

# Install unhcrthemes with pak
pak::pkg_install("unhcr-dataviz/unhcrthemes")
```

**Load the packages** into your R environment:

```{r setup}
# Load required packages
library(unhcrthemes)
library(refugees)
library(tidyverse)
```

Some packages installed above will be loaded using the `::` notation to make the code and intentions clearer.

For this tutorial, we'll use statistics provided by UNHCR. The refugee package allows us to access and work with this data. You can find more information on the datasets available and the use of the `{refugees}` package in [this blog post](https://www.unhcr.org/refugee-statistics/insights/explainers/refugees-r-package.html).

```{r caption}
# Set caption for all charts, as we will only use the refugees package
caption <- "Source: Refugee Data Finder<br>© UNHCR, The UN Refugee Agency"
```

## Bar chart

### Single bar chart

Let's start by creating a simple bar chart to visualize the top 10 refugee and other people in need of international protection by country of origin in 2022.

**Preparing the data:**

```{r bar-data}
# Keep only 2022 records, Sum refugees and oip,
# Keep only top 10, Wrap long label
bar_df <- refugees::population |>
  filter(year == 2022) |>
  summarise(
    refugees = sum(refugees, na.rm = TRUE) + sum(oip, na.rm = TRUE),
    .by = coo_name
  ) |>
  slice_max(order_by = refugees, n = 10) |>
  mutate(coo_name = str_wrap(coo_name, 25))
```

**Plot:**

```{r bar-plot, out.width="100%"}
# Set title and subtitle
title_bar <- "Refugees and other people in need of international protection"
subtitle_bar <- "By country of origin at the end of 2022"

# Plot
ggplot(
  bar_df,
  aes(
    x = refugees,
    y = reorder(coo_name, refugees)
  )
) +
  geom_col(
    fill = unhcr_pal(n = 1, "pal_blue"),
    width = 0.8
  ) +
  scale_x_continuous(
    expand = expansion(mult = c(0, .1)),
    breaks = seq(0, 7e6, by = 1e6),
    labels = scales::label_number(scale_cut = scales::cut_short_scale())
  ) +
  labs(
    title = title_bar,
    subtitle = subtitle_bar,
    caption = caption,
    x = "Number of people"
  ) +
  theme_unhcr(grid = "X", axis = "Y", axis_title = "X")
```

**Plot with labels:**

```{r bar-label, out.width="100%"}
# Plot with labels
ggplot(
  bar_df,
  aes(
    x = refugees,
    y = reorder(coo_name, refugees)
  )
) +
  geom_col(
    fill = unhcr_pal(n = 1, "pal_blue"),
    width = 0.8
  ) +
  geom_text(
    aes(
      label = scales::label_number(
        scale_cut = scales::cut_short_scale(),
        accuracy = .1
      )(refugees)
    ),
    hjust = -.2
  ) +
  scale_x_continuous(expand = expansion(mult = c(0, .1))) +
  labs(
    title = title_bar,
    subtitle = subtitle_bar,
    caption = caption
  ) +
  theme_unhcr(grid = FALSE, axis = "Y", axis_text = "Y", axis_title = FALSE)
```

### Grouped bar chart

Let's compare the refugee population originated by UNHCR region in 2012 and 2022 with the help of grouped bar chart.

**Preparing the data:**

```{r group-bar-data}
# Keep 2012 and 2022 records, Load and join region names,
# Group by year and region and sum refugees,
# Wrap long label, Remove NA
group_bar_df <- refugees::population |>
  filter(year == 2012 | year == 2022) |>
  left_join(refugees::countries, by = c("coo_iso" = "iso_code")) |>
  group_by(year, unhcr_region) |>
  summarise(refugees = sum(refugees, na.rm = TRUE)) |>
  mutate(unhcr_region = str_wrap(unhcr_region, 20)) |>
  filter(!is.na(unhcr_region))
```

**Plot:**

```{r group-bar-plot, out.width="100%"}
# Set title and subtitle
title_group_bar <- paste0(
  "Comparison of the total refugee population in <span style='color:",
  unhcr_pal(n = 2, "pal_blue")[1],
  "'>2012</span> and <span style='color:",
  unhcr_pal(n = 2, "pal_blue")[2],
  "'>2022</span> by region of origin"
)

# Plot
ggplot(
  group_bar_df,
  aes(
    x = refugees,
    y = fct_rev(as_factor(unhcr_region)),
    fill = as_factor(year)
  )
) +
  geom_col(
    width = .7,
    position = position_dodge(.8),
  ) +
  scale_x_continuous(
    expand = expansion(mult = c(0, .1)),
    labels = scales::label_number(scale_cut = scales::cut_short_scale())
  ) +
  scale_fill_unhcr_d(direction = -1) +
  labs(
    title = title_group_bar,
    caption = caption,
    x = "Number of people"
  ) +
  theme_unhcr(
    grid = "X", axis = "Y", axis_title = "X",
    legend = FALSE
  )
```

**Plot with labels:**

```{r group-bar-label, out.width="100%"}
# Plot with labels
ggplot(
  group_bar_df,
  aes(
    x = refugees,
    y = fct_rev(as_factor(unhcr_region)),
    fill = as_factor(year)
  )
) +
  geom_col(
    width = .7,
    position = position_dodge(.8),
  ) +
  geom_text(
    aes(
      label = scales::label_number(
        scale_cut = scales::cut_short_scale(),
        accuracy = .1
      )(refugees)
    ),
    position = position_dodge(.8),
    hjust = -.2
  ) +
  scale_x_continuous(expand = expansion(mult = c(0, .1))) +
  scale_fill_unhcr_d(direction = -1) +
  labs(
    title = title_group_bar,
    caption = caption,
  ) +
  theme_unhcr(
    grid = FALSE, axis = "Y", axis_title = FALSE,
    axis_text = "Y", legend = FALSE
  )
```

### Stacked bar chart

Let's start by creating a simple bar chart to visualize the top 10 refugee and other people in need of international protection by country of origin in 2022.

**Preparing the data:**

```{r stack-bar-data}
# Keep only 2022 records, Sum refugees and oip,
# Keep only top 10, Wrap long label
bar_df <- refugees::population |>
  filter(year == 2022) |>
  summarise(
    refugees = sum(refugees, na.rm = TRUE) + sum(oip, na.rm = TRUE),
    .by = coo_name
  ) |>
  slice_max(order_by = refugees, n = 10) |>
  mutate(coo_name = str_wrap(coo_name, 25))
```

**Plot:**

```{r stack-bar-plot, out.width="100%"}
# Set title and subtitle
title_bar <- "Refugees and other people in need of international protection"
subtitle_bar <- "By country of origin at the end of 2022"
caption <- "Source: Refugee Data Finder<br>© UNHCR, The UN Refugee Agency"

# Plot
ggplot(
  bar_df,
  aes(
    x = refugees,
    y = reorder(coo_name, refugees)
  )
) +
  geom_col(
    fill = unhcr_pal(n = 1, "pal_blue"),
    width = 0.8
  ) +
  scale_x_continuous(
    expand = expansion(mult = c(0, .1)),
    breaks = seq(0, 7e6, by = 1e6),
    labels = scales::label_number(scale_cut = scales::cut_short_scale())
  ) +
  labs(
    title = title_bar,
    subtitle = subtitle_bar,
    caption = caption,
    x = "Number of people"
  ) +
  theme_unhcr(grid = "X", axis = "Y", axis_title = "X")
```

**Plot with labels:**

```{r stack-bar-label, out.width="100%"}
# Plot with labels
ggplot(
  bar_df,
  aes(
    x = refugees,
    y = reorder(coo_name, refugees)
  )
) +
  geom_col(
    fill = unhcr_pal(n = 1, "pal_blue"),
    width = 0.8
  ) +
  geom_text(
    aes(
      label = scales::label_number(
        scale_cut = scales::cut_short_scale(),
        accuracy = .1
      )(refugees)
    ),
    hjust = -.2
  ) +
  scale_x_continuous(expand = expansion(mult = c(0, .1))) +
  labs(
    title = title_bar,
    subtitle = subtitle_bar,
    caption = caption
  ) +
  theme_unhcr(grid = FALSE, axis = "Y", axis_text = "Y", axis_title = FALSE)
```

### Population pyramid

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

**Plot with labels:**

```{r, out.width="100%"}
# Plot with labels
```

## Column chart

### Single column chart

A column chart is quite similar to a bar chart, but the bars are vertical. Let's make a column chart of the last 10 years of total refugee population.

**Preparing the data:**

```{r column-data}
# Keep only 2013-2022 records, Sum refugees, Make year factor
column_df <- refugees::population |>
  filter(year >= 2013) |>
  summarise(
    refugees = sum(refugees, na.rm = TRUE),
    .by = year
  ) |>
  mutate(year = as_factor(year))
```

**Plot:**

```{r column-plot, out.width="100%"}
# Set title
title_column <- "Total number of refugees | 2013-2022"

# Plot
ggplot(
  column_df,
  aes(x = year, y = refugees)
) +
  geom_col(
    fill = unhcr_pal(n = 1, "pal_blue"),
    width = 0.8
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, .1)),
    breaks = seq(0, 30e6, by = 5e6),
    labels = scales::label_number(scale_cut = scales::cut_short_scale())
  ) +
  labs(
    title = title_column,
    caption = caption,
    Y = "Number of people"
  ) +
  theme_unhcr(grid = "Y", axis = "X", axis_title = FALSE)
```

**Plot with labels:**

```{r column-label, out.width="100%"}
# Plot with labels
ggplot(
  column_df,
  aes(x = year, y = refugees)
) +
  geom_col(
    fill = unhcr_pal(n = 1, "pal_blue"),
    width = 0.8
  ) +
  geom_text(
    aes(
      label = scales::label_number(
        scale_cut = scales::cut_short_scale(),
        accuracy = .1
      )(refugees)
    ),
    vjust = -.4
  ) +
  scale_y_continuous(
    expand = expansion(mult = c(0, .1)),
    breaks = seq(0, 30e6, by = 5e6),
    labels = scales::label_number(scale_cut = scales::cut_short_scale())
  ) +
  labs(
    title = title_column,
    caption = caption,
    Y = "Number of people"
  ) +
  theme_unhcr(grid = FALSE, axis = "X", axis_title = FALSE, axis_text = "X")
```

### Grouped column chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

**Plot with labels:**

```{r, out.width="100%"}
# Plot with labels
```

### Stacked column chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

**Plot with labels:**

```{r, out.width="100%"}
# Plot with labels
```

### 100% stacked column chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

**Plot with labels:**

```{r, out.width="100%"}
# Plot with labels
```

## Line chart

### Single line chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

### Multiple line chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

**Plot with labels:**

```{r, out.width="100%"}
# Plot with labels
```

## Area chart

### Single area chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

### Stacked area chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```


## Pie chart

### Pie chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

### Donut chart

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

## Less common charts

### Treemap

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

### Streamgraph

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

### Sankey diagram

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```

### Slope

Lorem ipsum

**Preparing the data:**

```{r}
# Data manipulation
```

**Plot:**

```{r, out.width="100%"}
# Set title


# Plot
```